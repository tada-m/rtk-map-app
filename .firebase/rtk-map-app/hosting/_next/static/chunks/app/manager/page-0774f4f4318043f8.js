(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[50],{2690:(e,t,n)=>{Promise.resolve().then(n.bind(n,8141))},3201:(e,t,n)=>{"use strict";n.d(t,{db:()=>l,j:()=>a});var s=n(3915),i=n(5404),r=n(5317);let d=(0,s.Dk)().length?(0,s.Sx)():(0,s.Wp)({apiKey:"AIzaSyBhyFZVgwSjiIv7J8OjqkK9-YCpoKnTyNs",authDomain:"rtk-map-app.firebaseapp.com",projectId:"rtk-map-app",storageBucket:"rtk-map-app.firebasestorage.app",messagingSenderId:"770512095150",appId:"1:770512095150:web:897c370a971298b55f2a3f",measurementId:"G-Y267HG23R7"}),a=(0,i.xI)(d),l=(0,r.getFirestore)(d)},4974:(e,t,n)=>{"use strict";n.d(t,{db:()=>l,j:()=>a,y:()=>d});var s=n(3915),i=n(5404),r=n(5317);let d=(0,s.Dk)().length?(0,s.Sx)():(0,s.Wp)({apiKey:"AIzaSyBu4trMNDk_2ZzCq4gfn0hs7nsXGJFnJIw",authDomain:"physics-app-e10d2.firebaseapp.com",projectId:"physics-app-e10d2",storageBucket:"physics-app-e10d2.firebasestorage.app",messagingSenderId:"925210606673",appId:"1:925210606673:web:efd104fc824d381d484c70",measurementId:"G-DLZ2L7ZK3F"}),a=(0,i.xI)(d),l=(0,r.getFirestore)(d)},8141:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var s=n(5155),i=n(2115),r=n(5317),d=n(4974),a=n(5404),l=n(3201);function c(){let[e,t]=(0,i.useState)([]),[n,d]=(0,i.useState)(!0),[c,u]=(0,i.useState)(""),[j,p]=(0,i.useState)(null),[m,g]=(0,i.useState)(null),[b,y]=(0,i.useState)(!0);(0,i.useEffect)(()=>{let e=(0,a.xI)(),t=(0,a.hg)(e,e=>{g(e),y(!1)});return()=>t()},[]),(0,i.useEffect)(()=>{m&&(async()=>{d(!0);let e=(0,r.collection)(l.db,"users"),n=await (0,r.getDocs)(e),s=[];for(let e of n.docs){var i,a,c;let t=e.data(),n=(null==(i=t.studentData)?void 0:i.studentId)||t.studentId||"",d=(null==(a=t.studentData)?void 0:a.name)||t.name||"",l=(null==(c=t.studentData)?void 0:c.class)||t.class||"",o=(await (0,r.getDocs)((0,r.collection)(e.ref,"learningLog"))).docs.map(e=>e.data()),h=await (0,r.getDocs)((0,r.collection)(e.ref,"problemRecords")),x=h.docs.map(e=>e.data()),u=h.docs.map(e=>e.id),j=await (0,r.getDocs)((0,r.collection)(e.ref,"unitPriorities")),p=j.docs.map(e=>e.data()),m=j.docs.map(e=>e.id);s.push({uid:e.id,email:t.email||"(no email)",studentId:n,name:d,class:l,learningLog:o,problemRecords:x,problemRecordsDocNames:u,unitPriorities:p,unitPrioritiesDocNames:m})}t(s),d(!1)})()},[m]);let v=e.filter(e=>{let t=c.trim().toLowerCase();return e.class&&e.class.toLowerCase().includes(t)||e.studentId&&e.studentId.toLowerCase().includes(t)||e.name&&e.name.toLowerCase().includes(t)});return b?(0,s.jsx)("div",{children:"Loading..."}):m?(0,s.jsxs)("div",{style:{padding:24},children:[(0,s.jsx)("h1",{children:"教員用ダッシュボード"}),(0,s.jsx)("div",{style:{marginBottom:16},children:(0,s.jsx)("input",{type:"text",placeholder:"クラス・学籍番号・名前で検索",value:c,onChange:e=>u(e.target.value),style:{fontSize:16,padding:6,width:260}})}),n?(0,s.jsx)("div",{children:"読み込み中..."}):j?(0,s.jsxs)("div",{style:{marginBottom:24},children:[(0,s.jsx)("button",{onClick:()=>p(null),style:{marginBottom:12},children:"← 一覧に戻る"}),(0,s.jsxs)("h2",{children:[j.name||"(名前なし)","（",j.studentId||"-","）",j.class?" / クラス: ".concat(j.class):""]}),(0,s.jsxs)("div",{children:["メール: ",j.email]}),(0,s.jsxs)("div",{style:{marginTop:24},children:[(0,s.jsx)("h3",{children:"learningLog"}),(0,s.jsx)(o,{data:j.learningLog}),(0,s.jsx)("h3",{children:"problemRecords"}),(0,s.jsx)(h,{data:j.problemRecords,docNames:j.problemRecordsDocNames||[]}),(0,s.jsx)("h3",{children:"unitPriorities"}),(0,s.jsx)(x,{data:j.unitPriorities,docNames:j.unitPrioritiesDocNames||[]})]})]}):(0,s.jsxs)("table",{border:1,cellPadding:8,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"クラス"}),(0,s.jsx)("th",{children:"番号"}),(0,s.jsx)("th",{children:"名前"}),(0,s.jsx)("th",{children:"メールアドレス"}),(0,s.jsx)("th",{children:"学習記録件数"}),(0,s.jsx)("th",{children:"問題記録件数"}),(0,s.jsx)("th",{children:"詳細"})]})}),(0,s.jsx)("tbody",{children:v.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.class}),(0,s.jsx)("td",{children:e.studentId}),(0,s.jsx)("td",{children:e.name}),(0,s.jsx)("td",{children:e.email}),(0,s.jsx)("td",{children:e.learningLog.length}),(0,s.jsx)("td",{children:e.problemRecords.length}),(0,s.jsx)("td",{children:(0,s.jsx)("button",{onClick:()=>p(e),children:"表示"})})]},e.uid))})]})]}):(0,s.jsxs)("div",{style:{padding:24},children:[(0,s.jsx)("h1",{children:"教員用ダッシュボード"}),(0,s.jsx)("button",{onClick:async()=>{let e=new a.HF;await (0,a.df)((0,a.xI)(),e)},style:{fontSize:18,padding:"10px 24px",background:"#4285F4",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Googleアカウントでログイン"})]})}function o(e){let{data:t}=e;return t&&0!==t.length?(0,s.jsxs)("table",{border:1,cellPadding:6,style:{marginBottom:24,width:"100%"},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"problemId"}),(0,s.jsx)("th",{children:"probremPriority"}),(0,s.jsx)("th",{children:"scs"}),(0,s.jsx)("th",{children:"scsReason"}),(0,s.jsx)("th",{children:"timestamp"})]})}),(0,s.jsx)("tbody",{children:t.map((e,t)=>{var n;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.problemId||""}),(0,s.jsx)("td",{children:null!=(n=e.probremPriority)?n:""}),(0,s.jsx)("td",{children:e.scs||""}),(0,s.jsx)("td",{children:e.scsReason||""}),(0,s.jsx)("td",{children:e.timestamp?e.timestamp.seconds?new Date(1e3*e.timestamp.seconds).toISOString().replace("T"," ").slice(0,19):String(e.timestamp):""})]},t)})})]}):(0,s.jsx)("div",{children:"データなし"})}function h(e){let{data:t,docNames:n}=e;return t&&0!==t.length?(0,s.jsxs)("table",{border:1,cellPadding:6,style:{marginBottom:24,width:"100%"},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"ドキュメント名"}),(0,s.jsx)("th",{children:"attempts"}),(0,s.jsx)("th",{children:"probremPriority"})]})}),(0,s.jsx)("tbody",{children:t.map((e,t)=>{var i,r;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:n[t]}),(0,s.jsx)("td",{children:null!=(i=e.attempts)?i:""}),(0,s.jsx)("td",{children:null!=(r=e.probremPriority)?r:""})]},t)})})]}):(0,s.jsx)("div",{children:"データなし"})}function x(e){let{data:t,docNames:n}=e;return t&&0!==t.length?(0,s.jsxs)("table",{border:1,cellPadding:6,style:{marginBottom:24,width:"100%"},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"ドキュメント名"}),(0,s.jsx)("th",{children:"priority"})]})}),(0,s.jsx)("tbody",{children:t.map((e,t)=>{var i;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:n[t]}),(0,s.jsx)("td",{children:null!=(i=e.priority)?i:""})]},t)})})]}):(0,s.jsx)("div",{children:"データなし"})}function u(){let[e,t]=(0,i.useState)([]),[n,a]=(0,i.useState)([]),[l,c]=(0,i.useState)(!0),[o,h]=(0,i.useState)(""),[x,u]=(0,i.useState)(null),[j,p]=(0,i.useState)({}),[m,g]=(0,i.useState)(null),[b,y]=(0,i.useState)({}),v=async()=>{c(!0);try{let e=await (0,r.getDocs)((0,r.collection)(d.db,"units")),n=await (0,r.getDocs)((0,r.collection)(d.db,"problems"));t(e.docs.map(e=>({id:e.id,...e.data()}))),a(n.docs.map(e=>({id:e.id,...e.data()}))),h("")}catch(e){h("データ取得失敗: "+(e instanceof Error?e.message:""))}c(!1)};(0,i.useEffect)(()=>{v()},[]);let f=e=>{p({...j,[e.target.name]:e.target.value})},P=async()=>{try{await (0,r.updateDoc)((0,r.doc)(d.db,"units",x),{...j,PosX:Number(j.PosX),PosY:Number(j.PosY)}),u(null),v()}catch(e){alert("保存失敗: "+(e instanceof Error?e.message:""))}},D=async e=>{if(window.confirm("本当に削除しますか？"))try{await (0,r.deleteDoc)((0,r.doc)(d.db,"units",e)),v()}catch(e){alert("削除失敗: "+(e instanceof Error?e.message:""))}},C=e=>{y({...b,[e.target.name]:e.target.value})},S=async()=>{try{await (0,r.updateDoc)((0,r.doc)(d.db,"problems",m),{...b}),g(null),v()}catch(e){alert("保存失敗: "+(e instanceof Error?e.message:""))}},w=async e=>{if(window.confirm("本当に削除しますか？"))try{await (0,r.deleteDoc)((0,r.doc)(d.db,"problems",e)),v()}catch(e){alert("削除失敗: "+(e instanceof Error?e.message:""))}};return(0,s.jsxs)("div",{style:{marginTop:40},children:[(0,s.jsx)("h3",{children:"unitsコレクション一覧"}),l?(0,s.jsx)("div",{children:"読み込み中..."}):o?(0,s.jsx)("div",{style:{color:"red"},children:o}):(0,s.jsxs)("table",{border:1,cellPadding:6,style:{marginBottom:24},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"DocID"}),(0,s.jsx)("th",{children:"DependsOn"}),(0,s.jsx)("th",{children:"PosX"}),(0,s.jsx)("th",{children:"PosY"}),(0,s.jsx)("th",{children:"UnitName"}),(0,s.jsx)("th",{children:"imagePath"}),(0,s.jsx)("th",{children:"teachingMaterials"}),(0,s.jsx)("th",{children:"操作"})]})}),(0,s.jsx)("tbody",{children:e.map(e=>x===e.id?(0,s.jsxs)("tr",{style:{background:"#ffe"},children:[(0,s.jsx)("td",{children:e.id}),(0,s.jsx)("td",{children:(0,s.jsx)("input",{name:"DependsOn",value:j.DependsOn,onChange:f})}),(0,s.jsx)("td",{children:(0,s.jsx)("input",{name:"PosX",value:j.PosX,onChange:f})}),(0,s.jsx)("td",{children:(0,s.jsx)("input",{name:"PosY",value:j.PosY,onChange:f})}),(0,s.jsx)("td",{children:(0,s.jsx)("input",{name:"UnitName",value:j.UnitName,onChange:f})}),(0,s.jsx)("td",{children:(0,s.jsx)("input",{name:"imagePath",value:j.imagePath,onChange:f})}),(0,s.jsx)("td",{children:(0,s.jsx)("textarea",{name:"teachingMaterials",value:j.teachingMaterials||"",onChange:f,rows:4,style:{width:180},placeholder:"授業スライド:...\\n動画:...\\nスタディサプリ:..."})}),(0,s.jsxs)("td",{children:[(0,s.jsx)("button",{onClick:P,children:"保存"}),(0,s.jsx)("button",{onClick:()=>u(null),children:"キャンセル"})]})]},e.id):(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.id}),(0,s.jsx)("td",{children:e.DependsOn}),(0,s.jsx)("td",{children:e.PosX}),(0,s.jsx)("td",{children:e.PosY}),(0,s.jsx)("td",{children:e.UnitName}),(0,s.jsx)("td",{children:e.imagePath}),(0,s.jsx)("td",{style:{whiteSpace:"pre-line",maxWidth:200,fontSize:13},children:e.teachingMaterials}),(0,s.jsxs)("td",{children:[(0,s.jsx)("button",{onClick:()=>{u(e.id),p({...e})},children:"編集"}),(0,s.jsx)("button",{onClick:()=>D(e.id),children:"削除"})]})]},e.id))})]}),(0,s.jsx)("h3",{children:"problemsコレクション一覧"}),l?(0,s.jsx)("div",{children:"読み込み中..."}):o?(0,s.jsx)("div",{style:{color:"red"},children:o}):(0,s.jsxs)("table",{border:1,cellPadding:6,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"DocID"}),(0,s.jsx)("th",{children:"ProblemNumber"}),(0,s.jsx)("th",{children:"UnitID"}),(0,s.jsx)("th",{children:"page"}),(0,s.jsx)("th",{children:"imagePath"}),(0,s.jsx)("th",{children:"DependsOn"}),(0,s.jsx)("th",{children:"操作"})]})}),(0,s.jsx)("tbody",{children:n.map(e=>m===e.id?(0,s.jsxs)("tr",{style:{background:"#ffe"},children:[(0,s.jsx)("td",{children:e.id}),(0,s.jsx)("td",{children:(0,s.jsx)("input",{name:"ProblemNumber",value:b.ProblemNumber,onChange:C})}),(0,s.jsx)("td",{children:(0,s.jsx)("input",{name:"UnitID",value:b.UnitID,onChange:C})}),(0,s.jsx)("td",{children:(0,s.jsx)("input",{name:"page",value:b.page||"",onChange:C})}),(0,s.jsx)("td",{children:(0,s.jsx)("input",{name:"imagePath",value:b.imagePath||"",onChange:C})}),(0,s.jsx)("td",{children:(0,s.jsx)("input",{name:"DependsOn",value:b.DependsOn||"",onChange:C})}),(0,s.jsxs)("td",{children:[(0,s.jsx)("button",{onClick:S,children:"保存"}),(0,s.jsx)("button",{onClick:()=>g(null),children:"キャンセル"})]})]},e.id):(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.id}),(0,s.jsx)("td",{children:e.ProblemNumber}),(0,s.jsx)("td",{children:e.UnitID}),(0,s.jsx)("td",{children:e.page}),(0,s.jsx)("td",{children:e.imagePath}),(0,s.jsx)("td",{children:e.DependsOn}),(0,s.jsxs)("td",{children:[(0,s.jsx)("button",{onClick:()=>{g(e.id),y({...e})},children:"編集"}),(0,s.jsx)("button",{onClick:()=>w(e.id),children:"削除"})]})]},e.id))})]})]})}function j(){let[e,t]=(0,i.useState)(""),[n,a]=(0,i.useState)({DependsOn:"",PosX:"",PosY:"",UnitName:"",imagePath:"",teachingMaterials:""}),[l,c]=(0,i.useState)(""),o=e=>{a({...n,[e.target.name]:e.target.value})},h=async t=>{if(t.preventDefault(),!e)return c("ドキュメントIDを入力してください");try{await (0,r.setDoc)((0,r.doc)(d.db,"units",e),{...n,PosX:Number(n.PosX),PosY:Number(n.PosY)}),c("登録成功")}catch(e){e instanceof Error?c("登録失敗: "+e.message):c("登録失敗: 不明なエラー")}};return(0,s.jsxs)("form",{onSubmit:h,style:{border:"1px solid #ccc",padding:16,marginBottom:24},children:[(0,s.jsx)("h3",{children:"units 登録"}),(0,s.jsx)("input",{placeholder:"ドキュメントID (例: U001)",value:e,onChange:e=>t(e.target.value)}),(0,s.jsx)("input",{name:"DependsOn",placeholder:"DependsOn",value:n.DependsOn,onChange:o}),(0,s.jsx)("input",{name:"PosX",placeholder:"PosX (数値)",value:n.PosX,onChange:o}),(0,s.jsx)("input",{name:"PosY",placeholder:"PosY (数値)",value:n.PosY,onChange:o}),(0,s.jsx)("input",{name:"UnitName",placeholder:"UnitName",value:n.UnitName,onChange:o}),(0,s.jsx)("input",{name:"imagePath",placeholder:"imagePath (例: /images/physics/omori_tsuriai.png)",value:n.imagePath,onChange:o}),(0,s.jsx)("textarea",{name:"teachingMaterials",placeholder:"授業スライド:...\\n動画:...\\nスタディサプリ:...",value:n.teachingMaterials,onChange:o,rows:4,style:{width:320,marginTop:8}}),(0,s.jsx)("button",{type:"submit",children:"登録"}),(0,s.jsx)("div",{children:l})]})}function p(){let[e,t]=(0,i.useState)(""),[n,a]=(0,i.useState)({ProblemNumber:"",UnitID:"",page:"",imagePath:"",DependsOn:""}),[l,c]=(0,i.useState)(""),o=e=>{a({...n,[e.target.name]:e.target.value})},h=async t=>{if(t.preventDefault(),!e)return c("ドキュメントIDを入力してください");try{await (0,r.setDoc)((0,r.doc)(d.db,"problems",e),{...n}),c("登録成功")}catch(e){e instanceof Error?c("登録失敗: "+e.message):c("登録失敗: 不明なエラー")}};return(0,s.jsxs)("form",{onSubmit:h,style:{border:"1px solid #ccc",padding:16},children:[(0,s.jsx)("h3",{children:"problems 登録"}),(0,s.jsx)("input",{placeholder:"ドキュメントID (例: P001-01)",value:e,onChange:e=>t(e.target.value)}),(0,s.jsx)("input",{name:"ProblemNumber",placeholder:"ProblemNumber",value:n.ProblemNumber,onChange:o}),(0,s.jsx)("input",{name:"UnitID",placeholder:"UnitID",value:n.UnitID,onChange:o}),(0,s.jsx)("input",{name:"page",placeholder:"page (例: 12)",value:n.page,onChange:o}),(0,s.jsx)("input",{name:"imagePath",placeholder:"imagePath (例: /images/physics/problems/p001-01.png)",value:n.imagePath,onChange:o}),(0,s.jsx)("input",{name:"DependsOn",placeholder:"DependsOn (例: U001,U002)",value:n.DependsOn,onChange:o}),(0,s.jsx)("button",{type:"submit",children:"登録"}),(0,s.jsx)("div",{children:l})]})}function m(){let[e,t]=(0,i.useState)(null),[n,r]=(0,i.useState)(""),[l,o]=(0,i.useState)(!1),[h,x]=(0,i.useState)(""),m=(0,a.xI)(d.y);(0,i.useEffect)(()=>{let e=(0,a.hg)(m,e=>{t(e)});return()=>e()},[m]);let g=async()=>{r("");try{await (0,a.df)(m,new a.HF)}catch(e){r("ログイン失敗: "+(e instanceof Error?e.message:""))}},b=async()=>{await (0,a.CI)(m)};return e&&"IzbNbRAdETeV7MEZDVYnyFfXLl22"===e.uid?(0,s.jsxs)("div",{style:{maxWidth:500,margin:"40px auto"},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsx)("h2",{children:"管理者用データ登録ページ"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{style:{fontSize:14,marginRight:8},children:e.email}),(0,s.jsx)("button",{onClick:b,children:"ログアウト"})]})]}),(0,s.jsx)(j,{}),(0,s.jsx)(p,{}),(0,s.jsx)(u,{}),(0,s.jsxs)("div",{style:{marginTop:40,borderTop:"1px solid #ccc",paddingTop:24},children:[(0,s.jsx)("h3",{children:"教員用ダッシュボード閲覧"}),l?(0,s.jsx)(c,{}):(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"teacher"===h?(o(!0),r("")):r("パスワードが違います")},children:[(0,s.jsx)("input",{type:"password",value:h,onChange:e=>x(e.target.value),placeholder:"パスワード",style:{fontSize:18,padding:8}}),(0,s.jsx)("button",{type:"submit",style:{marginLeft:12,fontSize:18},children:"ログイン"}),n&&(0,s.jsx)("div",{style:{color:"red",marginTop:8},children:n})]})]})]}):e?(0,s.jsxs)("div",{style:{padding:40},children:[(0,s.jsx)("h2",{children:"管理者権限がありません"}),(0,s.jsxs)("div",{style:{margin:"16px 0"},children:["ログイン中: ",e.email]}),(0,s.jsx)("button",{onClick:b,children:"ログアウト"}),(0,s.jsxs)("div",{style:{marginTop:40,borderTop:"1px solid #ccc",paddingTop:24},children:[(0,s.jsx)("h3",{children:"教員用ダッシュボード閲覧"}),l?(0,s.jsx)(c,{}):(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"teacher"===h?(o(!0),r("")):r("パスワードが違います")},children:[(0,s.jsx)("input",{type:"password",value:h,onChange:e=>x(e.target.value),placeholder:"パスワード",style:{fontSize:18,padding:8}}),(0,s.jsx)("button",{type:"submit",style:{marginLeft:12,fontSize:18},children:"ログイン"}),n&&(0,s.jsx)("div",{style:{color:"red",marginTop:8},children:n})]})]})]}):(0,s.jsxs)("div",{style:{padding:40},children:[(0,s.jsx)("h2",{children:"管理者ログイン"}),(0,s.jsx)("button",{onClick:g,style:{fontSize:18,padding:8},children:"Googleでログイン"}),n&&(0,s.jsx)("div",{style:{color:"red",marginTop:8},children:n}),(0,s.jsxs)("div",{style:{marginTop:40,borderTop:"1px solid #ccc",paddingTop:24},children:[(0,s.jsx)("h3",{children:"教員用ダッシュボード閲覧"}),l?(0,s.jsx)(c,{}):(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"teacher"===h?(o(!0),r("")):r("パスワードが違います")},children:[(0,s.jsx)("input",{type:"password",value:h,onChange:e=>x(e.target.value),placeholder:"パスワード",style:{fontSize:18,padding:8}}),(0,s.jsx)("button",{type:"submit",style:{marginLeft:12,fontSize:18},children:"ログイン"}),n&&(0,s.jsx)("div",{style:{color:"red",marginTop:8},children:n})]})]})]})}}},e=>{e.O(0,[135,965,670,441,964,358],()=>e(e.s=2690)),_N_E=e.O()}]);