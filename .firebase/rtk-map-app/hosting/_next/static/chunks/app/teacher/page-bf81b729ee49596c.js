(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[411],{591:e=>{e.exports={"flowchart-physics-node":"FlowchartPhysics_flowchart-physics-node__NKcOQ","node-top-priority":"FlowchartPhysics_node-top-priority__SO2vw","priority-badge":"FlowchartPhysics_priority-badge__yVMFM","group-frame":"FlowchartPhysics_group-frame__fEWMf","group-label":"FlowchartPhysics_group-label__Af4Sf"}},3676:(e,t,i)=>{Promise.resolve().then(i.bind(i,7979))},4974:(e,t,i)=>{"use strict";i.d(t,{db:()=>a,j:()=>n,y:()=>d});var r=i(3915),s=i(5404),l=i(5317);let d=(0,r.Dk)().length?(0,r.Sx)():(0,r.Wp)({apiKey:"AIzaSyBu4trMNDk_2ZzCq4gfn0hs7nsXGJFnJIw",authDomain:"physics-app-e10d2.firebaseapp.com",projectId:"physics-app-e10d2",storageBucket:"physics-app-e10d2.firebasestorage.app",messagingSenderId:"925210606673",appId:"1:925210606673:web:efd104fc824d381d484c70",measurementId:"G-DLZ2L7ZK3F"}),n=(0,s.xI)(d),a=(0,l.getFirestore)(d)},7979:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>p});var r=i(5155),s=i(2115),l=i(5404),d=i(4974),n=i(591),a=i.n(n);function o(e){let{units:t,problems:i,unitPriorityMap:l,problemStats:d,onUnitClick:n,onProblemClick:o}=e,[c,h]=(0,s.useState)(null),p=t.length>0?Math.max(...t.map(e=>e.PosY||0)):1,m={},x=0;t.forEach(e=>{let t=l[e.id];if(void 0!==t&&t>0){let i=Math.ceil(t);m[e.id]=i,i>x&&(x=i)}else m[e.id]=0});let u=["モーメントの基本","つり合いの式","棒のつり合い","重心","モーメントの応用","今までの復習"],g={};u.forEach(e=>{g[e]=t.filter(t=>{var i,r;return i=t.PosX,r=t.PosY,(1===i&&r>=2&&r<=4?"モーメントの基本":2===i&&r>=3&&r<=4?"つり合いの式":3===i&&r>=3&&r<=4?"棒のつり合い":4===i&&r>=2&&r<=4?"重心":5===i&&r>=2&&r<=4?"モーメントの応用":1===r&&i>=1&&i<=5?"今までの復習":"")===e})});let j=u.map(e=>{let t=g[e];if(0===t.length)return null;let i=Math.min(...t.map(e=>e.PosX)),r=Math.max(...t.map(e=>e.PosX)),s=Math.min(...t.map(e=>e.PosY)),l=Math.max(...t.map(e=>e.PosY));return{group:e,left:40+(i-1)*200,top:50+(p-l)*150,width:(r-i+1)*200-30,height:(l-s+1)*150-30}});return(0,r.jsxs)("div",{style:{position:"relative",minHeight:810,minWidth:1080,maxWidth:1080,maxHeight:810,overflow:"hidden",padding:"40px"},children:[j.map((e,t)=>e&&(0,r.jsx)("div",{className:a()["group-frame"],style:{left:e.left,top:e.top,width:e.width,height:e.height},children:(0,r.jsx)("span",{className:a()["group-label"],children:e.group})},e.group)),t.map(e=>{let t=l[e.id],i=a()["flowchart-physics-node"];m[e.id]===x&&x>0&&(i+=" "+a()["node-top-priority"]);let s=null;if(void 0!==t&&t>0){let e=Math.ceil(t);e>0&&(s=(0,r.jsx)("span",{className:a()["priority-badge"],children:"⭐".repeat(e)}))}return(0,r.jsxs)("div",{id:e.id,className:i,style:{left:"".concat(42+(e.PosX-1)*200,"px"),top:"".concat(60+(p-e.PosY)*150,"px"),zIndex:10},onClick:()=>n&&n(e.id),children:[(0,r.jsx)("span",{children:e.UnitName}),s,e.imagePath&&(0,r.jsx)("img",{src:e.imagePath,alt:e.UnitName,style:{maxWidth:120,maxHeight:80,marginTop:8}})]},e.id)})]})}let c=e=>{let{unitName:t,problems:i,units:l,onClose:d,onUnitNodeClick:n}=e,[a,o]=s.useState(0),c=i[a],h=[];if(null==c?void 0:c.dependsOn){let e=c.dependsOn.split(",").map(e=>e.trim()).filter(Boolean);h=l.filter(t=>e.includes(t.id))}return(0,r.jsxs)("div",{style:{background:"#fff",borderRadius:16,padding:24,minWidth:500,boxShadow:"0 2px 8px #aaa",position:"absolute",top:60,left:100,zIndex:100},children:[(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[(0,r.jsx)("h2",{style:{margin:0},children:t}),(0,r.jsx)("button",{onClick:d,style:{fontSize:18,background:"#eee",border:"none",borderRadius:8,padding:"4px 12px",cursor:"pointer",marginLeft:16},children:"\xd7"})]}),(null==c?void 0:c.imagePath)&&(0,r.jsx)("div",{style:{margin:"16px 0 8px 0",textAlign:"left"},children:(0,r.jsx)("img",{src:c.imagePath,alt:c.problemNumber,style:{maxWidth:320,maxHeight:180,border:"1px solid #ccc",borderRadius:8}})})]}),h.length>0&&(0,r.jsxs)("div",{style:{margin:"16px 0 8px 24px",minWidth:220,border:"2px solid #222",borderRadius:16,padding:12,background:"#fafafa"},children:[(0,r.jsx)("div",{style:{fontWeight:"bold",marginBottom:8},children:"この問題に関連する知識"}),(0,r.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:12},children:h.map(e=>(0,r.jsxs)("div",{style:{border:"1px solid #aaa",borderRadius:8,padding:8,width:100,cursor:"pointer",textAlign:"center"},onClick:()=>{n&&(d(),n(e.id))},children:[(0,r.jsx)("div",{style:{fontSize:13,fontWeight:600},children:e.UnitName}),e.imagePath&&(0,r.jsx)("img",{src:e.imagePath,alt:e.UnitName,style:{maxWidth:80,maxHeight:50,marginTop:4}})]},e.id))})]})]}),(0,r.jsx)("h3",{style:{margin:"16px 0 8px 0"},children:"問題リスト（全ユーザー平均）"}),(0,r.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{style:{borderBottom:"1px solid #ccc",padding:6},children:"問題番号"}),(0,r.jsx)("th",{style:{borderBottom:"1px solid #ccc",padding:6},children:"復習優先度（平均）"}),(0,r.jsx)("th",{style:{borderBottom:"1px solid #ccc",padding:6},children:"解いた回数（平均）"})]})}),(0,r.jsx)("tbody",{children:i.map((e,t)=>(0,r.jsxs)("tr",{style:{cursor:"pointer",background:t===a?"#ffeedd":void 0},onClick:()=>o(t),children:[(0,r.jsx)("td",{style:{padding:6,textAlign:"center"},children:e.problemNumber}),(0,r.jsx)("td",{style:{padding:6,textAlign:"center"},children:isNaN(e.avgPriority)?"":e.avgPriority.toFixed(2)}),(0,r.jsx)("td",{style:{padding:6,textAlign:"center"},children:isNaN(e.avgAttempts)?"":e.avgAttempts.toFixed(2)})]},e.problemNumber?e.problemNumber:"row-".concat(t)))})]})]})};var h=i(5317);function p(){let[e,t]=(0,s.useState)(!1),[i,l]=(0,s.useState)(""),[d,n]=(0,s.useState)("");return e?(0,r.jsx)(m,{}):(0,r.jsxs)("div",{style:{padding:40},children:[(0,r.jsx)("h2",{children:"教員用ダッシュボード閲覧"}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"teacher"===i?(t(!0),n("")):n("パスワードが違います")},children:[(0,r.jsx)("input",{type:"password",value:i,onChange:e=>l(e.target.value),placeholder:"パスワード",style:{fontSize:18,padding:8}}),(0,r.jsx)("button",{type:"submit",style:{marginLeft:12,fontSize:18},children:"ログイン"})]}),d&&(0,r.jsx)("div",{style:{color:"red",marginTop:8},children:d})]})}function m(){var e;let[t,i]=(0,s.useState)([]),[n,a]=(0,s.useState)(!0),[p,m]=(0,s.useState)(""),[j,b]=(0,s.useState)(null),[y,f]=(0,s.useState)(null),[v,P]=(0,s.useState)(!0),[w,N]=(0,s.useState)({}),[S,D]=(0,s.useState)({}),[I,C]=(0,s.useState)([]),[_,k]=(0,s.useState)([]),[B,E]=(0,s.useState)([]),[O,U]=(0,s.useState)({}),[F,L]=(0,s.useState)({}),[R,A]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=(0,l.xI)(),t=(0,l.hg)(e,e=>{f(e),P(!1)});return()=>t()},[]),(0,s.useEffect)(()=>{y&&(async()=>{a(!0);let e=await (0,h.getDocs)((0,h.collection)(d.db,"problems")),t={},r=[];e.forEach(e=>{var i;let s=e.data();t[e.id]=s.ProblemNumber||e.id,r.push({id:e.id,UnitID:s.UnitID,ProblemNumber:null!=(i=s.ProblemNumber)?i:"",imagePath:s.imagePath,DependsOn:s.DependsOn,page:s.page})}),N(t),E(r);let s=await (0,h.getDocs)((0,h.collection)(d.db,"units")),l={},n=[];s.forEach(e=>{let t=e.data();l[e.id]=t.UnitName||e.id,n.push({id:e.id,UnitName:t.UnitName,DependsOn:t.DependsOn,PosX:Number(t.PosX),PosY:Number(t.PosY),imagePath:t.imagePath,group:t.group})}),D(l),k(n);let o=(0,h.collection)(d.db,"users"),c=await (0,h.getDocs)(o),p=[],m={},x={},u={};for(let e of c.docs){var g,j,b;let i=e.data(),r=(null==(g=i.studentData)?void 0:g.studentId)||i.studentId||"",s=(null==(j=i.studentData)?void 0:j.name)||i.name||"",d=(null==(b=i.studentData)?void 0:b.class)||i.class||"",n=(await (0,h.getDocs)((0,h.collection)(e.ref,"learningLog"))).docs.map(e=>{let i=e.data();return{...i,problemId:t[i.problemId]||i.problemId}}),a=await (0,h.getDocs)((0,h.collection)(e.ref,"problemRecords")),o=a.docs.map(e=>e.data()),c=a.docs.map(e=>t[e.id]||e.id);a.docs.forEach(e=>{let t=e.data(),i=e.id;x[i]||(x[i]=[]),u[i]||(u[i]=[]),"number"==typeof t.probremPriority&&x[i].push(t.probremPriority),"number"==typeof t.attempts&&u[i].push(t.attempts)});let y=await (0,h.getDocs)((0,h.collection)(e.ref,"unitPriorities")),f=y.docs.map(e=>e.data()),v=y.docs.map(e=>l[e.id]||e.id);y.docs.forEach(e=>{let t=e.id,i=e.data().priority;m[t]||(m[t]=[]),m[t].push(i)}),p.push({uid:e.id,email:i.email||"(no email)",studentId:r,name:s,class:d,learningLog:n,problemRecords:o,problemRecordsDocNames:c,unitPriorities:f,unitPrioritiesDocNames:v})}let y=n.map(e=>{let t=m[e.id]||[],i=t.length>0?t.reduce((e,t)=>e+t,0)/t.length:0;return{...e,name:e.UnitName,priority:i}});C(y);let f={};y.forEach(e=>{f[e.id]=e.priority}),U(f);let v={};r.forEach(e=>{let t=x[e.id]||[],i=u[e.id]||[],r=t.length>0?t.reduce((e,t)=>e+t,0)/t.length:0,s=i.length>0?i.reduce((e,t)=>e+t,0)/i.length:0;v[e.id]={avgPriority:r,avgAttempts:s}}),L(v),i(p),a(!1)})()},[y]);let M=t.filter(e=>{let t=p.trim().toLowerCase();return e.class&&e.class.toLowerCase().includes(t)||e.studentId&&e.studentId.toLowerCase().includes(t)||e.name&&e.name.toLowerCase().includes(t)});return v?(0,r.jsx)("div",{children:"Loading..."}):y?(0,r.jsxs)("div",{style:{padding:24},children:[(0,r.jsx)("h1",{children:"教員用ダッシュボード"}),(0,r.jsxs)("div",{style:{marginBottom:32},children:[(0,r.jsx)("h3",{children:"全ユーザー平均マップ"}),(0,r.jsxs)("div",{style:{position:"relative"},children:[(0,r.jsx)(o,{units:_,problems:B,unitPriorityMap:O,problemStats:F,onUnitClick:e=>A(e)}),R&&(0,r.jsx)(c,{unitName:(null==(e=_.find(e=>e.id===R))?void 0:e.UnitName)||"",problems:B.filter(e=>e.UnitID===R).map(e=>{var t,i,r,s,l,d,n;return{problemNumber:void 0!==e.ProblemNumber&&null!==e.ProblemNumber?String(e.ProblemNumber):"",avgPriority:null!=(r=null==(t=F[e.id])?void 0:t.avgPriority)?r:0,avgAttempts:null!=(s=null==(i=F[e.id])?void 0:i.avgAttempts)?s:0,imagePath:null!=(l=e.imagePath)?l:"",dependsOn:null!=(n=null!=(d=e.DependsOn)?d:e.DependsOn)?n:""}}),units:_,onClose:()=>A(null),onUnitNodeClick:e=>A(e)})]})]}),(0,r.jsx)("div",{style:{marginBottom:16},children:(0,r.jsx)("input",{type:"text",placeholder:"クラス・番号・名前で検索",value:p,onChange:e=>m(e.target.value),style:{fontSize:16,padding:6,width:260}})}),n?(0,r.jsx)("div",{children:"読み込み中..."}):j?(0,r.jsxs)("div",{style:{marginBottom:24},children:[(0,r.jsx)("button",{onClick:()=>b(null),style:{marginBottom:12},children:"← 一覧に戻る"}),(0,r.jsxs)("h2",{children:[j.name||"(名前なし)","（",j.studentId||"-","）",j.class?" / クラス: ".concat(j.class):""]}),(0,r.jsxs)("div",{children:["メール: ",j.email]}),(0,r.jsxs)("div",{style:{marginTop:24},children:[(0,r.jsx)("h3",{children:"learningLog"}),(0,r.jsx)(x,{data:j.learningLog}),(0,r.jsx)("h3",{children:"problemRecords"}),(0,r.jsx)(u,{data:j.problemRecords,docNames:j.problemRecordsDocNames||[]}),(0,r.jsx)("h3",{children:"unitPriorities"}),(0,r.jsx)(g,{data:j.unitPriorities,docNames:j.unitPrioritiesDocNames||[]})]})]}):(0,r.jsxs)("table",{border:1,cellPadding:8,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"クラス"}),(0,r.jsx)("th",{children:"番号"}),(0,r.jsx)("th",{children:"名前"}),(0,r.jsx)("th",{children:"メールアドレス"}),(0,r.jsx)("th",{children:"学習記録件数"}),(0,r.jsx)("th",{children:"問題記録件数"}),(0,r.jsx)("th",{children:"詳細"})]})}),(0,r.jsx)("tbody",{children:M.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.class}),(0,r.jsx)("td",{children:e.studentId}),(0,r.jsx)("td",{children:e.name}),(0,r.jsx)("td",{children:e.email}),(0,r.jsx)("td",{children:e.learningLog.length}),(0,r.jsx)("td",{children:e.problemRecords.length}),(0,r.jsx)("td",{children:(0,r.jsx)("button",{onClick:()=>b(e),children:"表示"})})]},e.uid))})]})]}):(0,r.jsxs)("div",{style:{padding:24},children:[(0,r.jsx)("h1",{children:"教員用ダッシュボード"}),(0,r.jsx)("button",{onClick:async()=>{let e=new l.HF;await (0,l.df)((0,l.xI)(),e)},style:{fontSize:18,padding:"10px 24px",background:"#4285F4",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Googleアカウントでログイン"})]})}function x(e){let{data:t}=e;return t&&0!==t.length?(0,r.jsxs)("table",{border:1,cellPadding:6,style:{marginBottom:24,width:"100%"},children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"problemId"}),(0,r.jsx)("th",{children:"probremPriority"}),(0,r.jsx)("th",{children:"scs"}),(0,r.jsx)("th",{children:"scsReason"}),(0,r.jsx)("th",{children:"timestamp"})]})}),(0,r.jsx)("tbody",{children:t.map((e,t)=>{var i;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.problemId||""}),(0,r.jsx)("td",{children:null!=(i=e.probremPriority)?i:""}),(0,r.jsx)("td",{children:e.scs||""}),(0,r.jsx)("td",{children:e.scsReason||""}),(0,r.jsx)("td",{children:e.timestamp?e.timestamp.seconds?new Date(1e3*e.timestamp.seconds).toISOString().replace("T"," ").slice(0,19):String(e.timestamp):""})]},t)})})]}):(0,r.jsx)("div",{children:"データなし"})}function u(e){let{data:t,docNames:i}=e;return t&&0!==t.length?(0,r.jsxs)("table",{border:1,cellPadding:6,style:{marginBottom:24,width:"100%"},children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"ドキュメント名"}),(0,r.jsx)("th",{children:"attempts"}),(0,r.jsx)("th",{children:"probremPriority"})]})}),(0,r.jsx)("tbody",{children:t.map((e,t)=>{var s,l;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:i[t]}),(0,r.jsx)("td",{children:null!=(s=e.attempts)?s:""}),(0,r.jsx)("td",{children:null!=(l=e.probremPriority)?l:""})]},t)})})]}):(0,r.jsx)("div",{children:"データなし"})}function g(e){let{data:t,docNames:i}=e;return t&&0!==t.length?(0,r.jsxs)("table",{border:1,cellPadding:6,style:{marginBottom:24,width:"100%"},children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"ドキュメント名"}),(0,r.jsx)("th",{children:"priority"})]})}),(0,r.jsx)("tbody",{children:t.map((e,t)=>{var s;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:i[t]}),(0,r.jsx)("td",{children:null!=(s=e.priority)?s:""})]},t)})})]}):(0,r.jsx)("div",{children:"データなし"})}}},e=>{e.O(0,[220,135,965,670,441,964,358],()=>e(e.s=3676)),_N_E=e.O()}]);