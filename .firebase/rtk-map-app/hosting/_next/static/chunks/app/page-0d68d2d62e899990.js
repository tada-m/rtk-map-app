(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{591:e=>{e.exports={"flowchart-physics-node":"FlowchartPhysics_flowchart-physics-node__NKcOQ","node-top-priority":"FlowchartPhysics_node-top-priority__SO2vw","priority-badge":"FlowchartPhysics_priority-badge__yVMFM","group-frame":"FlowchartPhysics_group-frame__fEWMf","group-label":"FlowchartPhysics_group-label__Af4Sf"}},887:(e,t,i)=>{"use strict";i.d(t,{A:()=>l});var s=i(5155),r=i(2115),a=i(5317),n=i(3201);function l(e){let{user:t,open:i,onClose:l}=e,[o,d]=(0,r.useState)(""),[c,h]=(0,r.useState)(""),[p,u]=(0,r.useState)(""),[m,y]=(0,r.useState)(!1),[g,f]=(0,r.useState)(""),[x,j]=(0,r.useState)("");(0,r.useEffect)(()=>{i&&(async()=>{y(!0),f(""),j("");try{let e=(0,a.H9)(n.db,"users",t.uid),i=(await (0,a.x7)(e)).data();i&&i.studentData&&(d(i.studentData.studentId||""),h(i.studentData.name||""),u(i.studentData.class||""))}catch(e){f("プロフィール取得に失敗しました")}finally{y(!1)}})()},[t,i]);let b=async e=>{if(e.preventDefault(),!o||!c||!p)return void f("学籍番号・名前・クラスを入力してください");y(!0),f(""),j("");try{let e=(0,a.H9)(n.db,"users",t.uid);await (0,a.BN)(e,{studentData:{studentId:o,name:c,class:p}},{merge:!0}),j("プロフィールを更新しました")}catch(e){f("更新に失敗しました: "+(e.message||""))}finally{y(!1)}};return i?(0,s.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.3)",zIndex:1e3},children:(0,s.jsxs)("div",{style:{background:"#fff",maxWidth:360,margin:"60px auto",padding:24,borderRadius:8,position:"relative"},children:[(0,s.jsx)("button",{onClick:l,style:{position:"absolute",right:12,top:12,fontSize:20},children:"\xd7"}),(0,s.jsx)("h2",{children:"プロフィール編集"}),(0,s.jsxs)("form",{onSubmit:b,children:[(0,s.jsxs)("div",{style:{marginBottom:12},children:[(0,s.jsx)("label",{children:"学籍番号"}),(0,s.jsx)("input",{type:"text",value:o,onChange:e=>d(e.target.value),style:{width:"100%",fontSize:16,padding:6}})]}),(0,s.jsxs)("div",{style:{marginBottom:12},children:[(0,s.jsx)("label",{children:"名前"}),(0,s.jsx)("input",{type:"text",value:c,onChange:e=>h(e.target.value),style:{width:"100%",fontSize:16,padding:6}})]}),(0,s.jsxs)("div",{style:{marginBottom:12},children:[(0,s.jsx)("label",{children:"クラス"}),(0,s.jsxs)("select",{value:p,onChange:e=>u(e.target.value),style:{width:"100%",fontSize:16,padding:6},children:[(0,s.jsx)("option",{value:"",children:"選択してください"}),(0,s.jsx)("option",{value:"A",children:"A"}),(0,s.jsx)("option",{value:"B",children:"B"})]})]}),(0,s.jsx)("button",{type:"submit",disabled:m,style:{width:"100%",fontSize:16,padding:8},children:m?"保存中...":"保存"}),g&&(0,s.jsx)("div",{style:{color:"red",marginTop:8},children:g}),x&&(0,s.jsx)("div",{style:{color:"green",marginTop:8},children:x})]})]})}):null}},2835:(e,t,i)=>{Promise.resolve().then(i.bind(i,6199))},3201:(e,t,i)=>{"use strict";i.d(t,{db:()=>o,j:()=>l});var s=i(3915),r=i(5404),a=i(5317);let n=(0,s.Dk)().length?(0,s.Sx)():(0,s.Wp)({apiKey:"AIzaSyBhyFZVgwSjiIv7J8OjqkK9-YCpoKnTyNs",authDomain:"rtk-map-app.firebaseapp.com",projectId:"rtk-map-app",storageBucket:"rtk-map-app.firebasestorage.app",messagingSenderId:"770512095150",appId:"1:770512095150:web:897c370a971298b55f2a3f",measurementId:"G-Y267HG23R7"}),l=(0,r.xI)(n),o=(0,a.aU)(n)},4974:(e,t,i)=>{"use strict";i.d(t,{db:()=>o,j:()=>l,y:()=>n});var s=i(3915),r=i(5404),a=i(5317);let n=(0,s.Dk)().length?(0,s.Sx)():(0,s.Wp)({apiKey:"AIzaSyBu4trMNDk_2ZzCq4gfn0hs7nsXGJFnJIw",authDomain:"physics-app-e10d2.firebaseapp.com",projectId:"physics-app-e10d2",storageBucket:"physics-app-e10d2.firebasestorage.app",messagingSenderId:"925210606673",appId:"1:925210606673:web:efd104fc824d381d484c70",measurementId:"G-DLZ2L7ZK3F"}),l=(0,r.xI)(n),o=(0,a.aU)(n)},6199:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>y});var s=i(5155),r=i(2115),a=i(5404),n=i(4974),l=i(5317),o=i(591),d=i.n(o);let c={"正解（微妙）":["たまたま解けた","時間がかかってしまった"],"不正解（惜しい）":["解き方をギリギリ思い出せなかった","防げた計算ミスがあった"]};function h(e){let{problem:t,record:i,lastRecord:a,handleRecord:n,loading:l}=e,[o,d]=(0,r.useState)(""),[h,p]=(0,r.useState)(""),[u,m]=(0,r.useState)([]),[y,g]=(0,r.useState)(!1),[f,x]=(0,r.useState)(!1);(0,r.useEffect)(()=>{g(!1),x(!1),d(""),p(""),m([])},[t.id]);let j=i.attempts>0||i.probremPriority>0?i.probremPriority.toFixed(1):"不明",[,b]=(0,r.useState)({}),v=async()=>{await n(t.id,o,h)&&(i&&i.history&&(i.history.push({scs:o,scsReason:h,timestamp:new Date}),b({})),g(!0),setTimeout(()=>x(!0),1200))};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("td",{children:[t.ProblemNumber,(0,s.jsxs)("div",{className:"previous-record",children:["セミナー物理基礎+物理 P. ",t.page]})]}),(0,s.jsxs)("td",{children:[(0,s.jsxs)("select",{className:"scs-select",value:o,onChange:e=>{let t=e.target.value;d(t),p(""),m(c[t]||[])},disabled:y,children:[(0,s.jsx)("option",{value:""}),(0,s.jsx)("option",{value:"正解（完璧）",children:" ⭕（\uD83D\uDE00完璧）"}),(0,s.jsx)("option",{value:"正解（微妙）",children:" ⭕（\uD83D\uDE42微妙）"}),(0,s.jsx)("option",{value:"不正解（惜しい）",children:" ❌（\uD83E\uDD14惜しい）"}),(0,s.jsx)("option",{value:"不正解（まだまだ）",children:" ❌（\uD83D\uDE25まだまだ）"})]}),(0,s.jsxs)("div",{className:"previous-record",children:["前回: ",(null==a?void 0:a.scs)||"記録なし"]})]}),(0,s.jsxs)("td",{children:[(0,s.jsxs)("select",{className:"scsReason-select",value:h,onChange:e=>p(e.target.value),disabled:0===u.length||y,children:[(0,s.jsx)("option",{value:""}),u.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),(0,s.jsx)("div",{className:"previous-record",children:(null==a?void 0:a.scsReason)||""})]}),(0,s.jsx)("td",{className:"problemPriority-display",children:j}),(0,s.jsx)("td",{className:"attempts-count",children:i.attempts}),(0,s.jsx)("td",{children:(0,s.jsx)("button",{className:"record-btn".concat(y?" recorded":"").concat(f?" fade":""),disabled:l||y,onClick:v,style:y?{background:"#ccc",color:"#888",cursor:"not-allowed"}:{},children:y?"記録完了":l?"記録中...":"記録"})})]})}function p(e){let{user:t,unitId:i,appState:a,setAppState:o,onClose:d}=e,[c,p]=(0,r.useState)(null),[u,m]=(0,r.useState)(!1),[y,g]=(0,r.useState)(a.records),[f,x]=(0,r.useState)(0);(0,r.useEffect)(()=>{g(a.records)},[a.records]);let j=a.units.find(e=>e.id===i),b=a.problems.filter(e=>e.UnitID===i),v=c?a.problems.find(e=>e.id===c):null,w=()=>v&&v.imagePath?v.imagePath:j&&j.imagePath?j.imagePath:void 0,P=[];if(v&&v.DependsOn){let e=String(v.DependsOn).split(",").map(e=>e.trim());P=a.units.filter(t=>e.includes(t.id))}let D=async(e,i,s)=>{if(!i)return alert("正解・不正解を選択してください。"),!1;if(("正解（微妙）"===i||"不正解（惜しい）"===i)&&!s)return alert("理解状況を選択してください。"),!1;m(!0);try{var r;let d=((e,t,i)=>{let s=JSON.parse(JSON.stringify(y));s[e]||(s[e]={attempts:0,history:[],probremPriority:0}),s[e].attempts=(s[e].attempts||0)+1;let r=s[e].probremPriority,n=a.problems.find(t=>t.id===e);if(!n)return s;let l=a.units.find(e=>e.id===n.UnitID);if(!l)return s;if("正解（完璧）"===t&&(r=0,s[e].history?s[e].history.push({scs:"正解（完璧）",scsReason:i,timestamp:new Date}):s[e].history=[{scs:"正解（完璧）",scsReason:i,timestamp:new Date}]),"たまたま解けた"===i){for(let n of(r=Math.min(r+1,4),s[e].history?s[e].history.push({scs:t,scsReason:i,timestamp:new Date}):s[e].history=[{scs:t,scsReason:i,timestamp:new Date}],a.problems))if(n.UnitID===l.id&&n.id!==e){let e=s[n.id];if(!e||0===e.attempts&&(!e.history||0===e.history.length)){s[n.id]={attempts:0,history:[],probremPriority:1};continue}"正解（完璧）"!==(e.history&&e.history.length>0?e.history[e.history.length-1].scs:void 0)&&(e.probremPriority=Math.min(e.probremPriority+1,4))}}if("時間がかかってしまった"===i&&(r=Math.min(r+1,4),s[e].history?s[e].history.push({scs:t,scsReason:i,timestamp:new Date}):s[e].history=[{scs:t,scsReason:i,timestamp:new Date}]),"防げた計算ミスがあった"===i&&(r=Math.min(r+1,4),s[e].history?s[e].history.push({scs:t,scsReason:i,timestamp:new Date}):s[e].history=[{scs:t,scsReason:i,timestamp:new Date}]),"解き方をギリギリ思い出せなかった"===i){r=Math.min(r+2,4);let t=[l.id];for(let i of(l.DependsOn&&t.push(...String(l.DependsOn).split(",").map(e=>e.trim())),a.problems))if(t.includes(i.UnitID)&&i.id!==e){let e=s[i.id];if(!e||0===e.attempts&&(!e.history||0===e.history.length)){s[i.id]={attempts:0,history:[],probremPriority:1};continue}"正解（完璧）"!==(e.history&&e.history.length>0?e.history[e.history.length-1].scs:void 0)&&(e.probremPriority=Math.min(e.probremPriority+1,4))}}if("不正解（まだまだ）"===t){r=Math.min(r+2,4);let t=[l.id];for(let i of(l.DependsOn&&t.push(...String(l.DependsOn).split(",").map(e=>e.trim())),a.problems))if(t.includes(i.UnitID)&&i.id!==e){let e=s[i.id];if(!e||0===e.attempts&&(!e.history||0===e.history.length)){s[i.id]={attempts:0,history:[],probremPriority:1};continue}"正解（完璧）"!==(e.history&&e.history.length>0?e.history[e.history.length-1].scs:void 0)&&(e.probremPriority=Math.min(e.probremPriority+1,4))}}return s[e].probremPriority=r,s})(e,i,s),{updatedUnitPriorities:c}=((e,t)=>{let i={},s=a.problems.reduce((e,t)=>(e[t.id]=t.UnitID,e),{}),r=a.units.reduce((e,t)=>(e[t.id]=t,e),{}),n=s[e],l=r[n],o=[n];for(let e of(l.DependsOn&&o.push(...String(l.DependsOn).split(",").map(e=>e.trim())),[...new Set(o)])){let s=a.problems.filter(t=>t.UnitID===e).map(e=>e.id),r=0,n=0;s.forEach(e=>{t[e]&&(t[e].probremPriority>0||(t[e].attempts||0)>0)&&(r+=t[e].probremPriority,n++)}),n>0&&(i[e]=Math.min(r/n,4))}return{updatedUnitPriorities:i}})(e,d);g(d);let h=(0,l.H9)(n.db,"users",t.uid),p=(0,l.wP)(n.db),u=(0,l.H9)((0,l.rJ)(h,"learningLog"));p.set(u,{problemId:e,scs:i,scsReason:s,probremPriority:d[e].probremPriority,timestamp:(0,l.O5)()});let m=(0,l.H9)(h,"problemRecords",e);return p.set(m,{probremPriority:d[e].probremPriority,attempts:((null==(r=a.records[e])?void 0:r.attempts)||0)+1,history:(0,l.hq)({scs:i,scsReason:s,timestamp:new Date})},{merge:!0}),Object.keys(c).forEach(e=>{let t=(0,l.H9)(h,"unitPriorities",e);p.set(t,{priority:c[e]})}),await p.commit(),o(e=>({...e,records:d,unitPriorities:{...e.unitPriorities,...c}})),!0}catch(e){return console.error("記録エラー:",e),alert("記録中にエラーが発生しました。"),g(a.records),!1}finally{m(!1)}};return j?(0,s.jsx)("div",{id:"detail-panel",children:(0,s.jsxs)("div",{className:"panel-content",children:[(0,s.jsxs)("div",{id:"detail-header",children:[(0,s.jsx)("h2",{id:"detail-unit-name",children:j.UnitName}),(0,s.jsx)("button",{id:"close-detail",title:"閉じる",onClick:()=>{x(e=>e+1),d()},children:"\xd7"})]}),(0,s.jsxs)("div",{id:"detail-body",style:{display:"flex",flexDirection:"row",minHeight:200},children:[(0,s.jsx)("div",{id:"detail-image-container",style:{width:400,height:300,display:"flex",alignItems:"center",justifyContent:"center",background:"#fff"},children:w()&&(0,s.jsx)("img",{id:"detail-image",src:w(),alt:j.UnitName,style:{maxWidth:"100%",maxHeight:"100%",width:"auto",height:"auto",display:"block"}})}),(0,s.jsx)("div",{style:{flex:1,marginLeft:24},children:v&&(0,s.jsxs)("div",{style:{border:"2px solid #222",borderRadius:16,padding:12,marginBottom:12},children:[(0,s.jsx)("div",{style:{fontWeight:"bold",marginBottom:8},children:"この問題に関連する知識"}),(0,s.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:12},children:P.map(e=>(0,s.jsxs)("div",{style:{border:"1px solid #aaa",borderRadius:8,padding:8,width:100,cursor:"pointer",textAlign:"center"},onClick:()=>{x(e=>e+1),p(null),d(),setTimeout(()=>o(t=>({...t,selectedUnitId:e.id})),0)},children:[(0,s.jsx)("div",{style:{fontSize:13,fontWeight:600},children:e.UnitName}),e.imagePath&&(0,s.jsx)("img",{src:e.imagePath,alt:e.UnitName,style:{maxWidth:80,maxHeight:50,marginTop:4}})]},e.id))})]})})]}),(0,s.jsx)("h3",{children:"問題リスト"}),(0,s.jsx)("div",{className:"table-wrapper",children:(0,s.jsxs)("table",{id:"problem-table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"問題番号"}),(0,s.jsx)("th",{children:"正解・不正解"}),(0,s.jsx)("th",{children:"理解状況"}),(0,s.jsx)("th",{children:"復習優先度"}),(0,s.jsx)("th",{children:"解いた回数"}),(0,s.jsx)("th",{children:"アクション"})]})}),(0,s.jsx)("tbody",{children:b.map(e=>{var t;let i=y[e.id]||{attempts:0,probremPriority:0,history:[]},r=(null==(t=i.history)?void 0:t.slice(-1)[0])||{},a=c===e.id;return(0,s.jsx)("tr",{style:a?{background:"#ffeedd"}:{},onClick:()=>p(e.id),children:(0,s.jsx)(h,{problem:e,record:i,lastRecord:r,handleRecord:D,loading:u})},e.id+"-"+f)})})]})})]})}):null}function u(e){let{user:t}=e,[a,o]=(0,r.useState)({units:[],problems:[],records:{},unitPriorities:{}}),[c,h]=(0,r.useState)(!0),[u,m]=(0,r.useState)(null),y=(0,r.useRef)([]);if((0,r.useEffect)(()=>{(async()=>{if(t){h(!0);try{let e=(await (0,l.GG)((0,l.rJ)(n.db,"units"))).docs.map(e=>{var t,i;let s=e.data(),r=(t=s.PosX,i=s.PosY,1===t&&i>=2&&i<=4?"モーメントの基本":2===t&&i>=3&&i<=4?"つり合いの式":3===t&&i>=3&&i<=4?"棒のつり合い":4===t&&i>=2&&i<=4?"重心":5===t&&i>=2&&i<=4?"モーメントの応用":1===i&&t>=1&&t<=5?"今までの復習":"");return{...s,id:e.id,group:r}}),i=(await (0,l.GG)((0,l.rJ)(n.db,"problems"))).docs.map(e=>({id:e.id,...e.data()})),s=(0,l.H9)(n.db,"users",t.uid),r=await (0,l.GG)((0,l.rJ)(s,"problemRecords")),a={};r.forEach(e=>{a[e.id]=e.data()});let d=await (0,l.GG)((0,l.rJ)(s,"unitPriorities")),c={};d.forEach(e=>{c[e.id]=e.data().priority}),o({units:e,problems:i,records:a,unitPriorities:c})}catch(e){console.error("Initialization failed:",e),alert("データの読み込みに失敗しました。")}finally{h(!1)}}})()},[t]),(0,r.useEffect)(()=>{y.current.forEach(e=>e.remove()),y.current=[];let e=null;return a.units.length>0&&!c&&i.e(495).then(i.t.bind(i,7495,23)).then(t=>{a.units.forEach(e=>{if(e.DependsOn){let i=document.getElementById(e.id);String(e.DependsOn).split(",").forEach(e=>{let s=document.getElementById(e.trim());if(s&&i){let e=new t.default(s,i,{color:"rgba(0, 0, 0, 0.6)",size:2,path:"straight",endPlug:"arrow1",dropShadow:!0,startSocket:"auto",endSocket:"auto"});y.current.push(e)}})}});let i=document.getElementById("flowchart-container");if(i){let t=()=>{y.current.forEach(e=>e.position())};i.addEventListener("scroll",t,{passive:!0}),e=()=>{i.removeEventListener("scroll",t)}}}),()=>{y.current.forEach(e=>e.remove()),y.current=[],e&&e()}},[a.units,c]),c)return(0,s.jsx)("div",{style:{padding:"2rem"},children:"Loading Flowchart..."});let g=a.units.length>0?Math.max(...a.units.map(e=>e.PosY||0)):1,f={},x=0;a.units.forEach(e=>{let t=a.unitPriorities[e.id];if(void 0!==t&&t>0){let i=Math.ceil(t);f[e.id]=i,i>x&&(x=i)}else f[e.id]=0});let j=["モーメントの基本","つり合いの式","棒のつり合い","重心","モーメントの応用","今までの復習"],b={};j.forEach(e=>{b[e]=a.units.filter(t=>t.group===e)});let v=j.map(e=>{let t=b[e];if(0===t.length)return null;let i=Math.min(...t.map(e=>e.PosX)),s=Math.max(...t.map(e=>e.PosX)),r=Math.min(...t.map(e=>e.PosY)),a=Math.max(...t.map(e=>e.PosY));return{group:e,left:40+(i-1)*200,top:50+(g-a)*150,width:(s-i+1)*200-30,height:(a-r+1)*150-30}});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{id:"flowchart-container",style:{position:"relative",minHeight:810,minWidth:1080,maxWidth:1080,maxHeight:810,overflow:"hidden",padding:"40px"},children:[v.map((e,t)=>e&&(0,s.jsx)("div",{className:d()["group-frame"],style:{left:e.left,top:e.top,width:e.width,height:e.height},children:(0,s.jsx)("span",{className:d()["group-label"],children:e.group})},e.group)),a.units.map(e=>{let t=a.unitPriorities[e.id],i=d()["flowchart-physics-node"];f[e.id]===x&&x>0&&(i+=" "+d()["node-top-priority"]);let r=null;if(void 0!==t&&t>0){let e=Math.ceil(t);e>0&&(r=(0,s.jsx)("span",{className:d()["priority-badge"],children:"⭐".repeat(e)}))}return(0,s.jsxs)("div",{id:e.id,className:i,style:{left:"".concat(42+(e.PosX-1)*200,"px"),top:"".concat(60+(g-e.PosY)*150,"px"),zIndex:10},onClick:()=>m(e.id),children:[(0,s.jsx)("span",{children:e.UnitName}),r,e.imagePath&&(0,s.jsx)("img",{src:e.imagePath,alt:e.UnitName,style:{maxWidth:120,maxHeight:80,marginTop:8}})]},e.id)})]}),u&&(0,s.jsx)(p,{user:t,unitId:u,appState:a,setAppState:o,onClose:()=>m(null)})]})}var m=i(887);function y(){let[e,t]=(0,r.useState)(null),[i,l]=(0,r.useState)(!0),[o,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=(0,a.hg)(n.j,e=>{t(e),l(!1)});return()=>e()},[]);let c=async()=>{let e=new a.HF;try{await (0,a.df)(n.j,e)}catch(e){console.error("Login failed:",e)}},h=async()=>{try{await (0,a.CI)(n.j)}catch(e){console.error("Logout failed:",e)}};return i?(0,s.jsx)("div",{style:{padding:"2rem"},children:"Loading..."}):(0,s.jsxs)("div",{id:"app",children:[(0,s.jsxs)("header",{children:[(0,s.jsx)("h1",{children:"物理学習マップ（剛体にはたらく力）"}),(0,s.jsx)("div",{id:"auth-container",children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{id:"user-info",children:["ようこそ, ",(0,s.jsx)("span",{id:"user-email",children:e.email})," さん"]}),(0,s.jsx)("button",{onClick:()=>d(!0),style:{marginRight:8},children:"プロフィール変更"}),(0,s.jsx)("button",{id:"logout-btn",onClick:h,children:"ログアウト"})]}):(0,s.jsx)("button",{id:"login-btn",onClick:c,children:"Googleアカウントでログイン"})})]}),(0,s.jsx)("main",{children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u,{user:e}),(0,s.jsx)(m.A,{user:e,open:o,onClose:()=>d(!1)})]}):(0,s.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:(0,s.jsx)("p",{children:"Googleアカウントでログインしてください。"})})})]})}}},e=>{e.O(0,[220,135,965,670,441,964,358],()=>e(e.s=2835)),_N_E=e.O()}]);